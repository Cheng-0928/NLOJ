<% set_page_title "Dashboard - " + @contest.title %>
<h4 class="page-header">
  Dashboard <small><%= @contest.title %></small>
</h4>

<div class="row" style="display: flex; align-items: center;">
  <div class="col-md-2">
    <%= link_to 'Back to Contest', contest_path(@contest), :class => 'btn btn-default btn-xs btn-block' %>
  </div>
  <div class="col-md-2">
    <%= link_to 'Submissions', contest_submissions_path(@contest), :class => 'btn btn-info btn-xs btn-block' %>
  </div>
  <div class="col-md-2">
    <%= link_to 'Refresh', {:controller => :contests, :action => :dashboard_update, :id => @contest.id}, :remote => true, :class => 'btn btn-info btn-xs btn-block', :id => 'refresh' %>
  </div>
  <div class="col-md-5 vcenter">
    <div class="switch"
        data-on-label="<i class='fui-check'></i>"
        data-off-label="<i class='fui-cross'></i>">
      <input id="enable_autorefresh" autocomplete=off type="checkbox" name="enable_autorefresh">
    </div>
    <label style="padding:5px 5px 0px;">Auto refresh, interval</label>
    <input id="refresh_interval" class="form-control input-sm flat" type="number" placeholder="Refresh interval" value=10 min=5 step=1 style="width:60px">
    <label style="padding:5px 5px 0px;">secs</label>
  </div>
</div>


<table class="table table-hover dashboard-table">
  <thead>
    <% if @contest.type_ioicamp? %>
      <tr>
        <th colspan=<%= ((user_signed_in? and current_user.admin?) ? 5 : 4) - 1 %> class="text-center"></th>
        <th colspan=<%= @tasks.length + 2 %> class="text-center">
          <div style="display: flex; justify-content: center; align-items: center;">
            <small class="display-switch-score">Score / Total Tries</small>
            <small class="display-switch-penalty">Penalty Tries / Last Grade</small>
            &nbsp;
              <div class="switch"
                  data-on-label="score"
                  data-off-label="penalty" id="display_switch_div">
                <input id="display_switch" autocomplete=off type="checkbox" name="display_switch" checked>
              </div>
          </div>
        </th>
        <th></th>
        <th></th>
      </tr>
    <% end %>
    <tr>
      <th>Rank</th>
      <th></th>
      <th>Username</th>
      <th>Nickname</th>
      <% @tasks.each_with_index do |task, index| %>
        <th><%= link_to ('p' + (65+index).chr), contest_problem_path(@contest, task) %></th>
      <% end %>
      <% if @contest.type_acm? %>
        <th>Solv</th>
        <th>Penalty</th>
      <% elsif @contest.type_ioicamp? %>
        <th>Score</th>
        <th>Penalty</th>
      <% else %>
        <th>Total</th>
      <% end %>
    </tr>
  </thead>
  <tbody id="dashboard_table_body">
    <%= render partial: 'dashboard_table', locals: {} %>
  </tbody>
</table>

<div class="row">
  <div class="col-md-2">
    <%= link_to 'Back to Contest', contest_path(@contest), :class => 'btn btn-default btn-xs btn-block' %>
  </div>
  <div class="col-md-2">
    <%= link_to 'Submissions', contest_submissions_path(@contest), :class => 'btn btn-info btn-xs btn-block' %>
  </div>
  <div class="col-md-8" id="last-update-div">
    Last Update: <%= Time.now.to_s(:clean) %>
  </div>
</div>

<script> contest_dashboard_main() </script>
<% if @contest.type_ioicamp? %>
  <script> ioicamp_contest_dashboard_main() </script>
<% end %>
